import { existsSync, readFileSync, writeFileSync } from "fs";

const filePath = "src\\data\\poems.json";

// New poems to be added
const newPoems = [
  {
    id: 10,
    title: "प्यार",
    language: "hindi",
    content: `क्या कभी है सोचा तुमने कहते प्यार हो जिसे
है क्या सच्ची वो प्यार या है कोई दूसरा ही यार
सोचो ज़रा अगर होता प्यार इतने आसानी से 
तो क्या प्यार न मिलता कृष्ण कन्हैया को
क्या सफल न होती राधा कृष्ण की वो अधूरी प्रेम कहानी 
कहा था कभी कृष्ण कन्हैया ने 
होते काफी है पहलू प्रेम के
हम सब किरदार इस रंगमंच के
चलते करते जैसे नचाए वो 

होते कई चरण इस प्रेम विभाग के
होते उसमें कई उपखंड हैं 
पार करना होता उसे एकएक है
जैसे आता पहला पड़ाव है
मित्रता कहते जिसे है
बनते एक गांठ में हैं 
रहते साथ में वो हैं 
होते आकर्षित जिसमें हैं 
दूसरा पड़ाव होता शुरू वहां से हैं 
प्रभावित होते एक दूसरे हैं 
देखते एक दूसरे को अलग नज़रिए से हैं 

लगाव होता एक दूसरे से हैं 
तीसरा पड़ाव शुरू होता वहां से हैं 
नहीं रह पाते एक दूसरे के बिना तब
रहना चाहते एक दूसरे के करीब जब
करीब रहते बनता एक जुनून हैं 
कुछ करने मिटने की बनती चाह जब हैं 
एक दूसरे को रखते सर आंखों पर हैं 
देखते एक दूसरे को खुप अलग हैं 

ईर्ष्या वहां होती शुरू हैं 
पांचवां पड़ाव इसे ही कहते हैं 
जुनून के बढ़ने से न देख सकते कही ओर हैं 
देखना चाहते बस साथ अपने ही उसे हैं 
जताना यहां अधिकार शुरू ही होता हैं 
कहते जिसे छठवां पड़ाव हैं 
अधिकार–संबंधी विषय यहां होता हैं 
एक दूसरे पर बस अधिकार देखा जाता हैं 

होते कई हरकतें यहां ऐसे हैं 
जिससे टूटता एक दिल हैं 
टूटे दिल की वज़ह से बिछड़ते एक दूसरे से हैं 
बिछड़ते ऊपर से हैं मगर मन जुड़ा जहां रहता हैं 
सही बोले तो सच्चे प्यार की सीढ़ी यही होती शुरू हैं 
दिल टूटने पर भी रहता लगाव जिससे हैं 
होती प्यार भरी लत उससे ही हैं 
लत ऐसी लगती उससे हैं 
न जता पाते कुछ तब उससे हैं 
ना जता पाते प्यार ईर्ष्या लगाव तब उससे 
बस रहते भ्रम में और थे रोते हैं 

होता जब इतना कुछ अंदर हैं 
प्रेम ईर्ष्या लगाव जुनून इतनी भावना 
घूमती जब साथ हैं, होती मुश्किल तब हैं 
इतनी भावनाओं के सागर की लहर 
जब होता अंदर हैं 
गुस्सा आता तब हैं 
ना सोचने की ताकत होती हैं 
न समझने को कुछ आता हैं 
दिल दिमाग़ में बस गुस्सा ही गुस्सा आता हैं 

जब करते पार पूरे ये पड़ाव हैं 
तब समझते एक दूसरे को देव हैं 
करते तब सच्चा प्यार हैं 
जब मिलके करते पार ये पड़ाव हैं 
होता तब ही एक दूसरे से हैं 
निस्वार्थ प्यार एक दूसरे से

होता पूरा ये खेल हैं 
जिसे कहते प्रेम हैं 
मानते लोग प्यार जिसे 
क्या कहते हो अभभी तुम प्रेम उसे?
प्यार के रूप माने होते कई हैं 
पर होते सब इन्हीं पड़ावों से पार हैं 
इसीलिए कहते इसे प्रेम हैं 
जो होता सबसे ऊपर हैं 
इसीलिए कहते इसे प्रेम हैं 
 `,
    preview: "क्या कभी है सोचा तुमने कहते प्यार हो जिसे/nहै क्या सच्ची वो प्यार या है कोई दूसरा ही यार\n",
  },  
];

// Check if file exists and has valid JSON
let poemsData = { poems: [] };
if (existsSync(filePath)) {
  try {
    const existingData = readFileSync(filePath, "utf8");
    poemsData = JSON.parse(existingData);
    if (!Array.isArray(poemsData.poems)) {
      throw new Error("Invalid format: 'poems' should be an array");
    }
  } catch (error) {
    console.error(
      "Error reading or parsing poems.json. Creating a new file.",
      error
    );
    poemsData = { poems: [] }; // Reset to default structure
  }
}

// Ensure unique IDs for new poems
const existingIds = new Set(poemsData.poems.map((poem) => poem.id));
newPoems.forEach((poem) => {
  while (existingIds.has(poem.id)) {
    poem.id++;
  }
  existingIds.add(poem.id);
  poemsData.poems.push(poem);
});

// Write updated data back to the file
try {
  writeFileSync(filePath, JSON.stringify(poemsData, null, 2), "utf8");
  console.log("Poems have been saved to poems.json");
} catch (error) {
  console.error("Error writing to poems.json:", error);
}
